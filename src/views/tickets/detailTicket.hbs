<ol class="breadcrumb" style="background-color: #fff; font-weight: bold !important; padding: 0.75rem 1rem !important;">
    <li class="breadcrumb-item"><a href="/ve">Vé Đặt</a></li>
    <li class="breadcrumb-item active" aria-current="page">Chi tiết Vé Đặt</li>
</ol>

<div class="container" style="background-color: #fff;">
    {{#each objectVe}}
    <div class="d-flex">
    <h6 style="padding: 10px 20px 10px 0; font-weight: bold;">Mã vé: <span style="color: #0C2C9C; font-style: italic;">{{this.idVe}}</span></h6>
    <h6 style="padding: 10px 20px; font-weight: bold;">Ngày mua: <span style="color: #0C2C9C; font-style: italic;">{{formatDate this.ngayMua}}</span></h6>
    </div>
    <hr>
        <form action="/ve/chitiet/{{this.idVe}}?_method=PUT" method="post" id="form-update-ve">
            <div class="row">
            <div class="col-sm-5">
                <div class="">
                    <label class="form-label">Poster</label>                    
                    <div id="output" class="rounded mx-auto d-block" style="width: 200px; height: 295px; overflow: hidden; background-color: aliceblue;">
                        <img id="img-preview" src="{{this.anh}}" style="width: 100%; height: 100%; object-fit: cover;" alt="Ảnh xem trước" />
                    </div>
                </div>   
            </div>
            <div class="col-sm-7">
                <div class="mb-4">
                    <h6 class="form-label">Tên phim: <span style="font-style: italic;text-align: end; color: #0C2C9C">{{this.tenPhim}}</span></h6>                    
                </div> 
                <div class="mb-4">
                    <h6 class="form-label">Ngày chiếu: <span style="font-style: italic;text-align: end; color: #0C2C9C">{{formatDate this.ngayChieu}}</span></h6>                    
                </div>              
                <div class="mb-4">
                    <h6 class="form-label">Ca chiếu: <span style="font-style: italic;text-align: end; color: #0C2C9C">{{this.tenPhongChieu}}: {{this.caChieu}}</span></h6>                    
                </div> 

                <div class="mb-4">
                    <h6 class="form-label">Vị trí ghế: <span style="font-style: italic;text-align: end; color: #0C2C9C">{{this.tenGhe}}</span></h6>                    
                </div> 
                <div class="mb-4">
                    <h6  class="form-label">Phương thức TT: <span style="font-style: italic;text-align: end; color: #0C2C9C">{{this.phuongThucTT}}</span></h6>                    
                </div>  
                <div class="mb-4">
                    <h6  class="form-label">Hình thức: <span style="font-style: italic;text-align: end; color: #0C2C9C">{{#if this.idNhanVien}}Mua vé tại quầy{{else}}Mua vé online{{/if}}</span></h6>                    
                </div>
                <div class="mb-4">
                    <h6  class="form-label">Tổng tiền vé (1): <span style="font-style: italic;text-align: end; color: #0C2C9C;background-color: #C4F3EE;">{{formatCurrency this.tongTienVe 'vnd'}}</span></h6>                    
                </div>                   
                <div class="d-flex mb-4 align-items-center">
                    <div class="me-2">
                        <label class="form-label align-self-center" style="margin-bottom: 0 !important;">Trạng thái vé</label>
                    </div>
                    <div class="">
                        <select class="form-control" style="background-color: #0C2C9C;font-weight: 400;font-style: italic; color: {{#eq this.trangThai 0}}#28a745{{/eq}}{{#eq this.trangThai 1}}#dc3545{{/eq}}{{#eq this.trangThai 2}}#332D2D{{/eq}}" name="trangThai" id="" {{#eq 0 this.trangThai}}disabled{{/eq}} {{#eq 2 this.trangThai}}disabled{{/eq}}>
                            <option value="1" {{#eq 1 this.trangThai}}selected{{/eq}}>Chưa thanh toán</option>
                            <option value="0"{{#eq 0 this.trangThai}}selected{{/eq}}>Đã thanh toán</option>
                            <option value="2"{{#eq 2 this.trangThai}}selected{{/eq}}  {{#eq 1 this.trangThai}}disabled{{/eq}}>Vé hết hạn</option>
                        </select>
                    </div>
                </div>                                                                                                 
            </div> 
        </div>
    </form> 
    <hr>
    <h6 class="fw-bold">Chi tiết sản phẩm</h6>    
    {{/each}}
    <div class="d-flex">
    {{#each listDoAn}}
        <div class="card me-3" style="width: 15rem;">
        <div class="d-flex justify-content-center align-items-center" style="width: 15rem; margin-top: 5px;">
            <div style="width: 100px; height: 100px; overflow: hidden;">
            <img src="{{this.anh}}" style="width: 100%; height: 100%; object-fit: cover;" class="img-thumbnail rounded-circle me-2" alt="">
            </div>
        </div>
        <div class="card-body">
            <ul class="list-group list-group-flush">
            <li class="list-group-item fw-bold">{{this.tenDoAn}}</li>
            <li class="list-group-item fw-bold">{{formatCurrency this.giaDoAn 'vnd'}} x {{this.soLuong}}</li>
            <li class="list-group-item fw-bolder">{{formatCurrency (multiply (parseInt this.soLuong) (parseFloat this.giaDoAn)) 'vnd'}}</li>
            </ul>        
        </div>
        </div>
    {{/each}}   
    </div>
    {{#each objectVe}}
    <h6 class="fw-bold" style="margin-top: 15px;">Tổng tiền đồ ăn (2): <span style="font-style: italic;text-align: end; color: #0C2C9C;background-color: #C4F3EE;">{{formatCurrency this.tongTienDoAn 'vnd'}}</span></h6>     

    <hr>
    <h6 class="fw-bold" style="background-color: antiquewhite; padding: 10px; margin-bottom: 10px;" >Thành tiền(1)+(2): <span style="font-size: 18px; font-style: italic;text-align: end; color: #0C2C9C;background-color: #C4F3EE;">{{formatCurrency this.tongTien 'vnd'}}</span></h6>     
    <div class="text-center">
        {{#eq this.trangThai 1}}
        <button class="btn btn-primary" id="btnSubmit" type="submit" style="padding: 10px; min-width: 400px; font-weight: bold; margin: 10px 0px 40px 0;">Cập nhật</button>
        {{/eq}}
    </div>
    {{/each}}
</div>

<script>
  var formSubmitVe = document.forms["form-update-ve"];
  var btnSubmit=document.getElementById("btnSubmit");

  btnSubmit.onclick = function(){
    formSubmitVe.submit()
  };
</script>

<script>
    // compare date with ngay chieu
    function compareDates(ngayChieu) {
        var today = new Date();
        var ngayChieuDate = new Date(ngayChieu);
        return ngayChieuDate >= today;
    }
    // format currency
    function formatCurrency(amount, currency) {
        return new Intl.NumberFormat('vi-VN', { style: 'currency', currency }).format(amount);
    }
    // format date   
    function formatDate(date) {
    return moment(date).format("HH:mm DD/MM/YYYY");
  } 
</script>